# Sensitivity analysis - Constraints

Linear programs are used to model real world problems. Such models are at best approximate and at worst inaccurate. As such, it is important to understand the *sensitivity* of our solution to changes in the model. This is broadly called *sensitivity analysis*. We will focus on understanding the dependence of the optimal objective value of the standard linear program \@ref(eq:standard-lp) on the constants $b_i$ and $c_j$.

## Matrix notation

In our previous analysis of the simplex method, we assumed that the constants $b_i$, $c_j$, and $a_{ij}$ were being dynamically updated. However, now we'll assume that they are fixed constants as our goal is no longer to run the simplex algorithm but rather to find the dependence of the solution on the initial values of these constants.

We will start by finding a succinct way to describe the dictionary at the optimal solution. Recall that the decision and slack variables are related to each other by the Equation \@ref(eq:standard-tableau) which can written as:

\begin{equation}
  \begin{bmatrix} A & I_m \end{bmatrix}
    \begin{bmatrix} x \\ w \end{bmatrix}
      = b.
  (\#eq:dictionary-matrix)
\end{equation}

Let $\widehat{A} := \begin{bmatrix} A & I_m \end{bmatrix}$. We'll decompose $\widehat{A}$ using the basic and non-basic variables. Suppose \@ref(eq:standard-lp) has an optimal solution. Then let $\mathcal{B}$ be the matrix formed by combining the columns of $\widehat{A}$ corresponding to the basic variables and let $\mathcal{N}$ be the matrix formed by combining the columns of $\widehat{A}$ corresponding to the non-basic variables. Let $x_{\mathcal{B}}$ be the vector of basic variables and $x_{\mathcal{N}}$ be the vector of non-basic variables. 

By rearranging the columns of $\widehat{A}$ if necessary, we can rewrite \@ref(eq:dictionary-matrix) as 

\begin{align}
  && 
    \begin{bmatrix} \mathcal{B} & \mathcal{N} \end{bmatrix}
    \begin{bmatrix} x_{\mathcal{B}} \\ x_{\mathcal{N}} \end{bmatrix}
      &= b,\\
  \implies 
  &&
    \mathcal{B} x_{\mathcal{B}} + \mathcal{N} x_{\mathcal{N}} &= b, \\
  \implies
  &&
    \mathcal{B} x_{\mathcal{B}} &= b -  \mathcal{N} x_{\mathcal{N}}.
\end{align}

One can show that the matrix $\mathcal{B}$ is always invertible (hence the name "basic" variables) and the above equation can be further simplified to the following:
\begin{equation}
  x_{\mathcal{B}} = \mathcal{B}^{-1} b - \mathcal{B}^{-1} \mathcal{N} x_{\mathcal{N}}.
  (\#eq:basic-non-basic-matrix)
\end{equation}

This is nothing but the dictionary at the optimal solution.

::: {.example} 

Consider Example \@ref(eq:bond-portfolio-lp) again. At the optimal solution $w_1$ and $w_2$ are non-basic and have the value 0, and $x$, $y$, and $w_3$ are basic with values $0.3$, $0.6$, and $0.9$, respectively. Using the above notation, we have 

\begin{align}
  \mathcal{B} = 
    \begin{bmatrix}
    3 & 6 & 0 \\
    2 & 1 & 0 \\
    1 & 1 & 1
    \end{bmatrix}, 
  x_{\mathcal{B}} 
    = \begin{bmatrix} x \\ y \\ w_3 \end{bmatrix}, \\
  \mathcal{N} = 
    \begin{bmatrix}
    1 & 0 \\
    0 & 1 \\
    0 & 0
    \end{bmatrix}, 
  x_{\mathcal{N}}
    = \begin{bmatrix} w_1 \\ w_2 \end{bmatrix}.
\end{align}
Using Equation \@ref(eq:basic-non-basic-matrix) the dictionary at the optimal solution becomes 
\begin{align}
  \begin{bmatrix} x \\ y \\ w_3 \end{bmatrix} 
   &= \begin{bmatrix}
    3 & 6 & 0 \\
    2 & 1 & 0 \\
    1 & 1 & 1
    \end{bmatrix}^{-1} 
    \begin{bmatrix}
    3.6 \\ 1.5 \\ 1 
    \end{bmatrix} - 
    \begin{bmatrix}
    3 & 6 & 0 \\
    2 & 1 & 0 \\
    1 & 1 & 1
    \end{bmatrix}^{-1} \begin{bmatrix}
    1 & 0 \\
    0 & 1 \\
    0 & 0
    \end{bmatrix}
  \begin{bmatrix} w_1 \\ w_2 \end{bmatrix} \\
  & 
  = \begin{bmatrix} 0.3 \\ 0.6 \\ 0.9 \end{bmatrix} 
  -
  \begin{bmatrix}
    2/9 & -1/3 \\ 
    -1/9 & 2/3 \\
    -1/9 & -1/3
  \end{bmatrix}
  \begin{bmatrix} w_1 \\ w_2 \end{bmatrix}.
\end{align}

This is precisely the dictionary \@ref(eq:example-dictionary-3) at the optimal solution.
:::

Because we set the non-basic variables $x_{\mathcal{N}}$ to 0 at any vertex, and in particular, at the the optimal solution, using the Equation \@ref(eq:basic-non-basic-matrix) we get the following useful result:

::: {.lemma}

Using the above notation, $\mathcal{B}^{-1}b$ is the value of the basic variables at the optimal solution.

:::


## Range of optimality 

We now try to determine the change in optimal solution as we change the constraint upper bounds $b_i$. It is likely that by changing $b_i$ we change the optimal solution. But we would want this change to be differentiable. This can be achieved by requiring the set of basic and non-basic variables to remain unchanged. In this case, the equation \@ref(eq:basic-non-basic-matrix) will still be the equation describing the dictionary at the optimal solution and the change in $b_i$ will result in a differentiable (in fact, smooth) change in $x_{\mathcal{B}}$.

::: {.example}

Suppose we vary $b_3 = 1$ in Example \@ref(eq:bond-portfolio-lp). One can check that at the optimal solution $w_1$ and $w_2$ are non-basic as long as $b_3 > 0.9$. Thus we can say that out model is a good model as long as the error in $b_3$ is less than $0.1$.

:::

Suppose we change $b_i$ to $b_i + \delta$, where $\delta$ is a real number, and leave all the other constants unchanged. This is equivalent to changing $b$ to $b + \delta e_i$ where $e_i$ is the $i^{th}$ standard basis vector. This changes equation \@ref(eq:basic-non-basic-matrix) to 

\begin{align}
  x_{\mathcal{B}} 
    &= \mathcal{B}^{-1} b + \delta \mathcal{B}^{-1} e_i - \mathcal{B}^{-1} \mathcal{N} x_{\mathcal{N}} \\
    &= \mathcal{B}^{-1} b + \delta (\mathcal{B}^{-1})_{i} - \mathcal{B}^{-1} \mathcal{N} x_{\mathcal{N}}.
\end{align}
where $(\mathcal{B}^{-1})_{i}$ denotes the $i^{th}$ column of $\mathcal{B}^{-1}$.

Note that the coefficients of $x_{\mathcal{N}}$ remain unchanged. So, for this dictionary to stay optimal we only need the constants to remain non-negative i.e.

\begin{align}
  \mathcal{B}^{-1} b + \delta (\mathcal{B}^{-1})_{i} \ge 0.
\end{align}

The **range of optimality** for $b_i$ is the interval $(b + \delta_-, b + \delta_+)$ such that $\mathcal{B}^{-1} b + \delta (\mathcal{B}^{-1})_{i} \ge 0$ for all $\delta \in (\delta_-, \delta_+)$.